<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
   
<mapper namespace="com.linker.review">

	<!-- 제일 큰 게시글 번호 가져오기 -->
	<select id="maxNo" resultType="java.lang.Integer">
		<![CDATA[
			SELECT max(review_no) FROM product_review
		]]>
	</select>
	
	<!-- 리뷰 쓰기 -->
	<insert id="insertReview" parameterType="com.linker.review.dto.ReviewDTO">
		<![CDATA[
			INSERT INTO product_review (review_no, id, product_no, subject, content, reg_date)
			SELECT IFNULL(MAX(review_no), 0) + 1, #{id}, #{product_no}, #{subject}, #{content}, now()
			FROM product_review
		]]>
	</insert>
	
	<!-- 리뷰 전체목록 가져오기 -->
	<select id="listAll" resultType="com.linker.review.dto.ReviewDTO">
		<![CDATA[
			SELECT review_no, id, product_no, subject, content, reg_date
			FROM product_review
			ORDER BY review_no desc
		]]>
	</select>

</mapper>