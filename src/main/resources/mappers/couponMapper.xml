<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
   
<mapper namespace="coupon">
	
	<!-- 유저쿠폰 목록 -->
	<select id="userCoupon" parameterType="com.linker.direct.coupon.dto.UserCouponDTO" resultType="com.linker.direct.coupon.dto.UserCouponDTO">
		<![CDATA[
			SELECT	coupon_id, user_id
			FROM	user_coupon
			WHERE user_id = #{user_id}
		]]>
	</select>
	
	<!-- 쿠폰 등록 -->
	<insert id="couponInsert" parameterType="com.linker.direct.coupon.dto.UserCouponDTO">
		<![CDATA[
			INSERT	INTO user_coupon (coupon_id, user_id)
			VALUES	(#{coupon_id}, #{user_id})
		]]>
	</insert>
	
	<!-- 쿠폰 목록 -->
	<select id="list" parameterType="com.linker.direct.coupon.dto.CouponDTO" resultType="com.linker.direct.coupon.dto.CouponDTO">
		<![CDATA[
			SELECT	name, discount_price, discount_rate, min_price, created_at, updated_at, expired_date, status
			FROM	coupon c, user_coupon uc
			WHERE	c.coupon_id = uc.coupon_id
			AND		uc.user_id = 1;
		]]>
	</select>
	
	<!-- 쇼핑몰 쿠폰 생성, 목록, 수정, 삭제-->
	<insert id="create" parameterType="com.linker.direct.coupon.dto.CouponDTO">
		<![CDATA[
			INSERT INTO coupon (name, discount_price, discount_rate, min_price, expired_date)
			VALUES (#{name}, #{discount_price}, #{discount_rate}, #{min_price}, #{expired_date})
		]]>
	</insert>

	<select id="listAll" resultType="com.linker.direct.coupon.dto.CouponDTO">
		<![CDATA[
			SELECT	coupon_id, name, discount_price, discount_rate, min_price, created_at, updated_at, expired_date, status
			FROM	coupon
		]]>
	</select>

	<select id="read" parameterType="java.lang.Long" resultType="com.linker.direct.coupon.dto.CouponDTO">
		<![CDATA[
			SELECT	coupon_id, name, discount_price, discount_rate, min_price, created_at, updated_at, expired_date, status
			FROM	coupon
			WHERE	coupon_id = #{coupon_id}
		]]>
	</select>

	<update id="update" parameterType="com.linker.direct.coupon.dto.CouponDTO">
		<![CDATA[
			UPDATE	coupon
			SET		name = #{name}, discount_price = #{discount_price}, discount_rate = #{discount_rate}, min_price = #{min_price}, expired_date = #{expired_date}
			WHERE	coupon_id = #{coupon_id}
		]]>
	</update>

	<delete id="delete" parameterType="java.lang.Long">
		<![CDATA[
			DELETE	FROM coupon
			WHERE	coupon_id = #{coupon_id}
		]]>
	</delete>

</mapper>