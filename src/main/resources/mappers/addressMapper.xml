<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
   
<mapper namespace="com.linker.util">

	<!-- 아이디에 해당하는 유저 주소 리스트 추출하기 -->
	<select id="addressList" resultType="com.linker.util.address.AddressDTO" parameterType="com.linker.util.address.AddressDTO">
		<![CDATA[
			SELECT address_id, user_id, receiver, phone, address, address_detail, zip_code, created_at, updated_at, status
			FROM address
		]]>
	</select>
	
	<!-- 주소 등록 -->
	<insert id="insertAddress" parameterType="com.linker.util.address.AddressDTO">
		<![CDATA[
			INSERT INTO address (address_id, user_id, receiver, phone, address, address_detail, zip_code, created_at, updated_at, status)
			SELECT IFNULL(MAX(address_id), 0) + 1, #{user_id}, #{receiver}, #{phone}, #{address}, #{address_detail}, #{zip_code}, now(), now(), 'NORMAL'
			FROM address
		]]>
	</insert>
	
	<!-- 주소 고유 번호에 해당하는 주소 삭제하기  -->
	<delete id="delete" parameterType="int">
		<![CDATA[
		DELETE	FROM	address
		WHERE	address_id = #{address_id}
		]]>
	</delete>
	
	<!-- 주소 상세보기(주소목록 고유 번호에 해당하는 주소 정보 추출) -->
	<select id="detail" resultType="com.linker.util.address.AddressDTO">
		<![CDATA[
			SELECT address_id, user_id, receiver, phone, address, address_detail, zip_code, created_at, updated_at, status
			FROM address
			WHERE address_id = #{address_id}
		]]>
	</select>
	
	<!-- 주소 수정  -->
	<update id="update">
		<![CDATA[
		UPDATE	address
		SET		receiver=#{receiver}, phone=#{phone}, zip_code=#{zip_code}, address=#{address}, address_detail=#{address_detail}
		WHERE	address_id = #{address_id}
		]]>
	</update>
	
	<!-- 아이디에 해당하는 회원 정보 주소만 수정하기 -->
	<!-- 주소리스트에서 주소 선택 시 myinfo 테이블 주소를 변경 -->
	<update id="updateAddress" parameterType="com.linker.util.address.AddressDTO">
		<![CDATA[
		UPDATE 	myinfo
		SET address = (select address from address where address_id = #{address_id}),
			zip_code = (select zip_code from address where address_id = #{address_id}),
			address_detail = (select address_detail from address where address_id = #{address_id})
		WHERE user_id = #{user_id};
		]]>
	</update>

	
</mapper>